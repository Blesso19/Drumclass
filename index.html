<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>JamMeet â€“ Video + Drum Machine + Score</title>
<style>
    body { margin:0; font-family: sans-serif; background:#111; color:white; }
    .tabs { display:flex; background:#222; }
    .tab { flex:1; padding:15px; text-align:center; cursor:pointer; border-bottom:3px solid transparent; }
    .active { border-bottom:3px solid #0af; }
    .section { display:none; padding:20px; }
    .show { display:block; }
    video { width: 100%; max-height:300px; background:#000; }
    .drum-pad { width:100px; height:100px; background:#333; margin:10px; display:flex; justify-content:center; align-items:center; border-radius:10px; cursor:pointer; border:2px solid #555; }
    .drum-pad:active { background:#555; }
    .drum-machine { display:flex; flex-wrap:wrap; }
    .score-lines { margin-top:20px; border:1px solid #555; height:150px; background:repeating-linear-gradient( to bottom, #222, #222 26px, #fff 27px, #fff 28px ); }
</style>
</head>
<body>

<!-- Tabs -->
<div class="tabs">
    <div class="tab active" onclick="showTab('video')">Video</div>
    <div class="tab" onclick="showTab('jam')">Jam</div>
    <div class="tab" onclick="showTab('score')">Score</div>
</div>

<!-- VIDEO SECTION -->
<div id="video" class="section show">
    <h2>Video Chat Demo</h2>
    <button onclick="startLocal()">Start Local Demo</button>
    <br><br>
    <video id="localVideo" autoplay playsinline></video>
</div>

<!-- JAM SECTION -->
<div id="jam" class="section">
    <h2>Drum Machine</h2>
    <div class="drum-machine">
        <div class="drum-pad" onclick="playKick()">Kick</div>
        <div class="drum-pad" onclick="playSnare()">Snare</div>
        <div class="drum-pad" onclick="playHat()">Hi-Hat</div>
    </div>
</div>

<!-- SCORE SECTION -->
<div id="score" class="section">
    <h2>5-Line Score Notation</h2>
    <div class="score-lines"></div>
</div>

<script>
// ---------------- TAB SYSTEM ----------------
function showTab(tab) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.section').forEach(s => s.classList.remove('show'));
    document.querySelector(`[onclick="showTab('${tab}')"]`).classList.add('active');
    document.getElementById(tab).classList.add('show');
}

// ---------------- VIDEO DEMO ----------------
async function startLocal() {
    const video = document.getElementById('localVideo');
    try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
        video.srcObject = stream;
    } catch (err) {
        alert('Camera error: ' + err);
    }
}

// ---------------- DRUM MACHINE ----------------
const audio = new (window.AudioContext || window.webkitAudioContext)();

function playKick() {
    const osc = audio.createOscillator();
    const gain = audio.createGain();
    osc.frequency.setValueAtTime(120, audio.currentTime);
    osc.frequency.exponentialRampToValueAtTime(40, audio.currentTime + 0.5);
    gain.gain.setValueAtTime(1, audio.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, audio.currentTime + 0.5);
    osc.connect(gain).connect(audio.destination);
    osc.start(); osc.stop(audio.currentTime + 0.5);
}

function playSnare() {
    const noiseBuf = audio.createBuffer(1, audio.sampleRate * 0.2, audio.sampleRate);
    const data = noiseBuf.getChannelData(0);
    for (let i = 0; i < data.length; i++) data[i] = Math.random() * 2 - 1;
    const noise = audio.createBufferSource();
    noise.buffer = noiseBuf;
    const gain = audio.createGain();
    gain.gain.setValueAtTime(1, audio.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audio.currentTime + 0.2);
    noise.connect(gain).connect(audio.destination);
    noise.start(); noise.stop(audio.currentTime + 0.2);
}

function playHat() {
    const noiseBuf = audio.createBuffer(1, audio.sampleRate * 0.05, audio.sampleRate);
    const data = noiseBuf.getChannelData(0);
    for (let i = 0; i < data.length; i++) data[i] = Math.random() * 2 - 1;
    const noise = audio.createBufferSource();
    noise.buffer = noiseBuf;
    const bp = audio.createBiquadFilter();
    bp.type = 'highpass'; bp.frequency.value = 6000;
    const gain = audio.createGain(); gain.gain.value = 0.3;
    noise.connect(bp).connect(gain).connect(audio.destination);
    noise.start(); noise.stop(audio.currentTime + 0.05);
}
</script>
</body>
</html>
