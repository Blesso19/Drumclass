<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Drums Class — Live Studio</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
  :root{
    --bg:#050507;
    --panel:#0f1114;
    --card:#0b0b0d;
    --accent:#7ef9ff;
    --accent-2:#9b59ff;
    --muted:#9aa0a6;
    --glass: rgba(255,255,255,0.03);
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter, system-ui, -apple-system, Arial, sans-serif;background:linear-gradient(180deg,#010103,#071018);color:#fff;min-height:100vh;display:flex;flex-direction:column}
  #lobby{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:
    radial-gradient(800px 400px at 10% 10%, rgba(123,58,255,0.06), transparent),
    radial-gradient(600px 300px at 90% 90%, rgba(0,240,255,0.04), transparent);
    z-index:50;}
  .lobby-card{width:760px;max-width:92vw;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border-radius:14px;padding:28px;display:grid;grid-template-columns:1fr 360px;gap:20px;box-shadow:0 10px 40px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.03)}
  .lobby-left{padding:6px}
  .brand{display:flex;align-items:center;gap:14px}
  .brand .logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:700;color:#031;box-shadow:0 6px 18px rgba(124, 234, 255, 0.06)}
  .brand h1{margin:0;font-size:20px;color:var(--accent)}
  .lead{color:var(--muted);margin-top:8px}
  .lobby-cta{display:flex;gap:10px;margin-top:18px}
  .btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:10px 14px;border-radius:10px;color:#fff;cursor:pointer;font-weight:600}
  .btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#021}
  .lobby-right{background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border-radius:10px;padding:16px;border:1px solid rgba(255,255,255,0.03)}
  .input{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff}
  .small{font-size:13px;color:var(--muted)}
  .container{display:none;grid-template-columns:1fr 360px;gap:18px;padding:18px;margin-top:72px}
  .left{display:flex;flex-direction:column;gap:12px}
  .video-stage{background:linear-gradient(180deg,#0b0b0d,#111217);border-radius:12px;padding:12px;min-height:360px;display:flex;gap:12px}
  .local-video,.remote-video{flex:1;background:#000;border-radius:8px;position:relative;overflow:hidden}
  video{width:100%;height:100%;object-fit:cover;background:#000}
  .controls{display:flex;gap:8px;align-items:center}
  .btn.toggled{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#021}
  .panel{background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
  .right{display:flex;flex-direction:column;gap:12px}
  .chat{height:170px;overflow:auto}
  .chat .msg{padding:8px;border-radius:8px;margin-bottom:8px;background:rgba(255,255,255,0.02)}
  .sequencer{padding:12px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent)}
  .seq-row{display:flex;align-items:center;gap:8px;margin-bottom:8px}
  .instrument{width:72px;color:var(--muted)}
  .steps{display:grid;grid-template-columns:repeat(64,1fr);gap:6px;flex:1}
  .step{height:30px;border-radius:6px;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;cursor:pointer}
  .step.active{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#021}
  .notation{height:160px;border-radius:8px;overflow:hidden}
  canvas{width:100%;height:100%;display:block}
  footer{padding:12px;text-align:center;color:var(--muted)}
  input[type=range]{width:160px}
  .room{display:flex;gap:8px;align-items:center}
  .shareLink{background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;word-break:break-all}
  @media(max-width:980px){
    .lobby-card{grid-template-columns:1fr;gap:12px;padding:18px}
    .container{grid-template-columns:1fr}
  }
</style>
</head>
<body>
<!-- Lobby Screen -->
<div id="lobby" role="dialog" aria-modal="true">
  <div class="lobby-card" role="document">
    <div class="lobby-left">
      <div class="brand">
        <div class="logo">DJ</div>
        <div>
          <h1>Drums Jam — Live Studio</h1>
          <div class="small">Dark Studio Lobby — create or join a jam session</div>
        </div>
      </div>

      <p class="lead">Start a live drum lesson or jam with your students. Create a secure, shareable session link and have people join with that link or ID.</p>

      <div style="margin-top:16px">
        <label class="small">Create a session (shareable link)</label>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="lobbyCreate" class="btn primary">Create Session</button>
          <button id="demoCreate" class="btn">Create Local Demo</button>
        </div>
      </div>

      <div style="margin-top:18px">
        <label class="small">Join a session (paste link or ID)</label>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input id="lobbyJoinInput" class="input" placeholder="Paste meeting link or MEET-XXXX" />
          <button id="lobbyJoinBtn" class="btn">Join</button>
        </div>
        <div style="margin-top:10px" class="small">Tip: Use the full link or the short ID (MEET-XXXX).</div>
      </div>
    </div>

    <div class="lobby-right">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="small">Session privacy</div>
          <div style="font-weight:600;margin-top:6px">Link-only access — only those with the link can join</div>
        </div>
        <div style="text-align:right">
          <div class="small">Theme</div>
          <div style="font-weight:600;color:var(--accent);margin-top:6px">Dark Studio</div>
        </div>
      </div>

      <div style="margin-top:12px">
        <div class="small">Preview</div>
        <div style="height:140px;border-radius:8px;background:linear-gradient(90deg,rgba(126,249,255,0.03),rgba(155,89,255,0.02));margin-top:8px;display:flex;align-items:center;justify-content:center;color:var(--muted)">Live Session Preview</div>
      </div>

      <div style="margin-top:12px">
        <div class="small">Saved sessions (local demo)</div>
        <div id="localSessionsBox" class="small" style="margin-top:8px;color:var(--muted)">No local sessions yet</div>
      </div>

    </div>
  </div>
</div>

<!-- Main Session (hidden until join/create) -->
<div id="app" class="container" style="display:none;">
  <div class="left">
    <div class="panel video-stage">
      <div class="local-video">
        <video id="localVideo" autoplay muted playsinline></video>
        <div style="position:absolute;right:8px;bottom:8px;background:rgba(0,0,0,0.4);padding:6px;border-radius:6px;font-size:13px">You (preview)</div>
      </div>
      <div class="remote-video">
        <video id="remoteVideo" autoplay playsinline></video>
        <div style="position:absolute;right:8px;bottom:8px;background:rgba(0,0,0,0.4);padding:6px;border-radius:6px;font-size:13px">Room view</div>
      </div>
    </div>

    <div class="panel controls">
      <div class="room" style="flex:1;align-items:center">
        <div id="sessionInfo" style="display:flex;flex-direction:column">
          <div style="font-weight:600" id="sessionIdText">Session: <span class="small">—</span></div>
          <div id="sessionLinkBox" class="shareLink small" style="margin-top:6px">No session</div>
        </div>
      </div>
      <div style="flex:1"></div>
      <button id="camBtn" class="btn">Camera</button>
      <button id="micBtn" class="btn">Mic</button>
      <button id="shareBtn" class="btn">Share Screen</button>
      <button id="recordBtn" class="btn">Record</button>
    </div>

    <div class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><strong>Metronome</strong> <span class="small">(plays with sequencer)</span></div>
        <div style="display:flex;align-items:center;gap:8px">
          <input type="range" id="tempo" min="40" max="220" value="120"> <div id="tempoLabel">120 BPM</div>
        </div>
      </div>
    </div>

    <div class="panel sequencer">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <strong>Drum Sequencer</strong>
        <div style="display:flex;gap:8px;align-items:center"><button id="playSeq" class="btn">Play</button><button id="stopSeq" class="btn">Stop</button></div>
      </div>

      <div id="rows"></div>

      <div style="display:flex;gap:8px;margin-top:10px;align-items:center">
        <button id="clearSeq" class="btn">Clear</button>
        <label class="small">Steps</label>
        <select id="stepsCount" class="btn">
          <option>8</option>
          <option>16</option>
          <option>32</option>
          <option selected>64</option>
        </select>
      </div>
    </div>

  </div>

  <aside class="right">
    <div class="panel notation">
      <canvas id="notationCanvas"></canvas>
    </div>

    <div class="panel chat">
      <div style="display:flex;justify-content:space-between;align-items:center"><strong>Chat / Notes</strong><div id="sessionShare" class="small"></div></div>
      <div id="messages" style="margin-top:8px"></div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <input id="chatInput" placeholder="Type message" class="input">
        <button id="sendChat" class="btn">Send</button>
      </div>
    </div>

    <div class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>Recordings</strong>
        <small class="small">Local only</small>
      </div>
      <div id="recs" style="margin-top:8px"></div>
    </div>
  </aside>
</div>

<footer style="margin-top:auto">Prototype — Supabase-ready. To enable real-time sessions, add your Supabase URL & Key in the script below.</footer>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
<script>
/* ===== Sequencer changes ===== */
const instruments = [{id:'kick',label:'Kick'},{id:'snare',label:'Snare'},{id:'hihat',label:'Hi-Hat'}];
let steps = 64; // default to 64 steps
let seq = {};
instruments.forEach(inst => seq[inst.id] = new Array(steps).fill(false));

const rows = document.getElementById('rows'); 
const stepsCount = document.getElementById('stepsCount');
const playSeq = document.getElementById('playSeq'); 
const stopSeq = document.getElementById('stopSeq'); 
const clearSeq = document.getElementById('clearSeq');

/* Build sequencer UI */
function buildSequencer(){
  rows.innerHTML='';
  instruments.forEach(inst=>{
    const row = document.createElement('div'); row.className='seq-row';
    const lab = document.createElement('div'); lab.className='instrument'; lab.textContent = inst.label; row.appendChild(lab);
    const stepsWrap = document.createElement('div'); stepsWrap.className='steps';
    for(let i=0;i<steps;i++){
      const s = document.createElement('div'); s.className='step'; s.dataset.i=i; s.dataset.inst=inst.id;
      s.addEventListener('click',()=>{
        seq[inst.id][i] = !seq[inst.id][i];
        s.classList.toggle('active', seq[inst.id][i]);
        renderNotation();
        pushStateToCloud();
      });
      if(seq[inst.id][i]) s.classList.add('active');
      stepsWrap.appendChild(s);
    }
    row.appendChild(stepsWrap); rows.appendChild(row);
  });
}
buildSequencer();

/* Change steps dynamically */
stepsCount.addEventListener('change',()=>{
  steps = parseInt(stepsCount.value);
  instruments.forEach(inst => seq[inst.id] = new Array(steps).fill(false));
  buildSequencer();
  renderNotation();
});

/* Initialize sample pattern for 64 steps */
(function(){
  seq.kick[0]=true; seq.kick[16]=true; seq.kick[32]=true; seq.kick[48]=true;
  seq.snare[8]=true; seq.snare[24]=true; seq.snare[40]=true; seq.snare[56]=true;
  for(let i=0;i<64;i+=4) seq.hihat[i]=true;
  buildSequencer();
  renderNotation();
})();
</script>
</body>
</html>
