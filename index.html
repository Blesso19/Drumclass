<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>JamMeet — Single HTML</title>
  <style>
    :root{--bg:#0f172a;--card:#0b1220;--muted:#94a3b8;--accent:#06b6d4;--glass:rgba(255,255,255,0.04)}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{background:linear-gradient(180deg,#0f172a 0%, #071029 100%);color:#e6eef8;display:flex;align-items:flex-start;justify-content:center;padding:20px}
    .app{width:100%;max-width:1200px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
    h1{font-size:20px;margin:0}
    .tabs{display:flex;gap:8px}
    .tab{padding:8px 12px;border-radius:8px;background:var(--glass);cursor:pointer;color:var(--muted);border:1px solid rgba(255,255,255,0.03)}
    .tab.active{background:linear-gradient(90deg,var(--accent),#7dd3fc);color:#022;box-shadow:0 6px 18px rgba(2,6,23,0.6)}

    main{display:grid;grid-template-columns:1fr 320px;gap:16px}
    .panel{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.03)}

    /* Video area */
    .video-wrap{display:flex;gap:12px;flex-direction:column}
    @media(min-width:880px){.video-wrap{flex-direction:row}}
    .video-stage{flex:1;min-height:240px;background:#000;border-radius:10px;overflow:hidden;position:relative}
    video{width:100%;height:100%;object-fit:cover;background:#000}
    .controls{display:flex;flex-direction:column;gap:8px;width:260px}
    .btn{display:inline-block;padding:10px;border-radius:8px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.03);cursor:pointer;color:var(--muted);text-align:center}
    .btn.primary{background:var(--accent);color:#022}
    .small{font-size:13px;padding:8px;border-radius:6px}

    /* Jam layout */
    .jam-grid{display:grid;grid-template-columns:1fr 320px;gap:12px}
    .pads{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .pad{padding:18px;border-radius:10px;text-align:center;cursor:pointer;user-select:none;font-weight:600}

    /* Sequencer */
    .seq-row{display:flex;gap:6px;align-items:center}
    .seq-steps{display:grid;grid-template-columns:repeat(8,1fr);gap:6px;flex:1}
    .step{height:40px;border-radius:6px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);cursor:pointer}
    .step.on{background:var(--accent);color:#022}
    .step.playing{box-shadow:0 0 0 3px rgba(6,182,212,0.12)}

    /* Score */
    .staff{background:transparent;padding:10px}

    /* sidebar */
    aside .list{display:flex;flex-direction:column;gap:10px;margin-top:6px}
    .participant{display:flex;align-items:center;gap:10px}
    .avatar{width:36px;height:36px;border-radius:999px;flex-shrink:0;background:linear-gradient(90deg,#7dd3fc,#0ea5a4)}

    footer{margin-top:12px;text-align:center;color:var(--muted);font-size:13px}

    /* responsive */
    @media(max-width:980px){main{grid-template-columns:1fr} .controls{width:100%} .jam-grid{grid-template-columns:1fr} .pads{grid-template-columns:repeat(3,1fr)} }
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <h1>JamMeet — Single HTML</h1>
      <nav class="tabs" id="tabs">
        <div class="tab active" data-tab="video">Video</div>
        <div class="tab" data-tab="jam">Jam</div>
        <div class="tab" data-tab="score">Score</div>
        <div class="tab" data-tab="fx">Live FX</div>
      </nav>
    </header>

    <main>
      <section class="panel" id="mainPanel">
        <!-- content changes by tab -->
        <div id="content">
          <!-- Video tab default content (rendered by JS) -->
        </div>
      </section>

      <aside class="panel">
        <div>
          <h3 style="margin:0 0 6px 0">Session</h3>
          <div style="color:var(--muted);font-size:13px">Local demo — no backend. Use Jam tab to create beats live.</div>
        </div>

        <div class="list">
          <div>
            <h4 style="margin:8px 0 6px 0">Participants</h4>
            <div class="participant"><div class="avatar"></div><div style="flex:1">You (host)</div><div style="font-size:12px;color:var(--muted)">audio muted</div></div>
            <div class="participant"><div class="avatar" style="background:linear-gradient(90deg,#fda4af,#fb7185)"></div><div style="flex:1">Guest (placeholder)</div><div style="font-size:12px;color:var(--muted)">video off</div></div>
          </div>

          <div>
            <h4 style="margin:8px 0 6px 0">Shortcuts</h4>
            <div style="font-size:13px;color:var(--muted);line-height:1.6">Space → Play / Stop<br>Numbers 1–8 → Toggle steps<br>Click pad → Trigger sound</div>
          </div>

        </div>
        <div style="margin-top:12px;color:var(--muted);font-size:12px">Made with ❤️ — JamMeet prototype</div>
      </aside>
    </main>

    <footer>Responsive single-file app — works on mobile, tablet and desktop.</footer>
  </div>

  <script>
  // ----- Application state & helpers -----
  const TABS = document.querySelectorAll('.tab');
  const content = document.getElementById('content');
  let currentTab = 'video';

  const pads = [
    { id: 'kick', label: 'Kick', color: ['#0f172a','#0ea5a4'] },
    { id: 'snare', label: 'Snare', color: ['#0f172a','#7c3aed'] },
    { id: 'hhc', label: 'HiHat C', color: ['#0f172a','#f97316'] },
    { id: 'hho', label: 'HiHat O', color: ['#0f172a','#f59e0b'] },
    { id: 'tom1', label: 'Tom 1', color: ['#0f172a','#ef4444'] },
    { id: 'ride', label: 'Ride', color: ['#0f172a','#60a5fa'] }
  ];
  let sequence = pads.map(()=> new Array(8).fill(false));
  let bpm = 100; let isPlaying=false; let stepIndex = 0; let playTimer = null;
  const padToLine = { kick:4, snare:2, hhc:1, hho:0, tom1:3, ride:1 };

  // WebAudio
  const AudioContext = window.AudioContext || window.webkitAudioContext;
  const audioCtx = new AudioContext();

  function playKick(time){
    const ctx = audioCtx; const o = ctx.createOscillator(); const g = ctx.createGain();
    o.frequency.setValueAtTime(150, time); o.frequency.exponentialRampToValueAtTime(0.001, time+0.5);
    g.gain.setValueAtTime(1, time); g.gain.exponentialRampToValueAtTime(0.001, time+0.5);
    o.connect(g); g.connect(ctx.destination); o.start(time); o.stop(time+0.6);
  }
  function playSnare(time){
    const ctx = audioCtx;
    const bufferSize = ctx.sampleRate * 0.2; const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
    const data = buffer.getChannelData(0); for(let i=0;i<bufferSize;i++) data[i]=(Math.random()*2-1);
    const noise = ctx.createBufferSource(); noise.buffer=buffer; const noiseFilter=ctx.createBiquadFilter(); noiseFilter.type='highpass'; noiseFilter.frequency.value=1000;
    const noiseGain=ctx.createGain(); noiseGain.gain.setValueAtTime(1,time); noiseGain.gain.exponentialRampToValueAtTime(0.01,time+0.2);
    noise.connect(noiseFilter); noiseFilter.connect(noiseGain); noiseGain.connect(ctx.destination); noise.start(time); noise.stop(time+0.25);
    const o = ctx.createOscillator(); o.type='triangle'; o.frequency.setValueAtTime(180,time); const g=ctx.createGain(); g.gain.setValueAtTime(0.7,time); g.gain.exponentialRampToValueAtTime(0.01,time+0.2);
    o.connect(g); g.connect(ctx.destination); o.start(time); o.stop(time+0.25);
  }
  function playHiHat(time, open=false){
    const ctx=audioCtx; const bufferSize = ctx.sampleRate * (open?0.12:0.05); const buffer=ctx.createBuffer(1,bufferSize,ctx.sampleRate);
    const data=buffer.getChannelData(0); for(let i=0;i<bufferSize;i++) data[i]=(Math.random()*2-1);
    const noise = ctx.createBufferSource(); noise.buffer=buffer; const filter=ctx.createBiquadFilter(); filter.type='highpass'; filter.frequency.value=7000;
    const gain=ctx.createGain(); gain.gain.setValueAtTime(0.6,time); gain.gain.exponentialRampToValueAtTime(open?0.05:0.001,time + (open?0.6:0.06));
    noise.connect(filter); filter.connect(gain); gain.connect(ctx.destination); noise.start(time); noise.stop(time + (open?0.6:0.06));
  }
  function playTom(time){ const ctx=audioCtx; const o=ctx.createOscillator(); o.type='sine'; o.frequency.setValueAtTime(250,time); o.frequency.exponentialRampToValueAtTime(120,time+0.3); const g=ctx.createGain(); g.gain.setValueAtTime(0.9,time); g.gain.exponentialRampToValueAtTime(0.01,time+0.3); o.connect(g); g.connect(ctx.destination); o.start(time); o.stop(time+0.4); }
  function triggerPad(id, when=0){ const t = when || audioCtx.currentTime; if(id==='kick') playKick(t); if(id==='snare') playSnare(t); if(id==='hhc'||id==='hho') playHiHat(t, id==='hho'); if(id==='tom1') playTom(t); if(id==='ride') playHiHat(t,true); }

  // ----- UI Rendering for tabs -----
  function render(){
    if(currentTab==='video') renderVideo();
    else if(currentTab==='jam') renderJam();
    else if(currentTab==='score') renderScore();
    else renderFX();
  }

  // Video tab
  let localStream = null; let cameraOn=false; let micOn=false; function renderVideo(){
    content.innerHTML = `
      <div class="video-wrap">
        <div class="video-stage" id="videoStage">
          <video id="localVideo" autoplay playsinline muted style="min-height:240px"></video>
          <div id="cameraOverlay" style="position:absolute;left:12px;top:12px;color:var(--muted);font-size:13px"></div>
        </div>
        <div class="controls">
          <button id="startBtn" class="btn primary">Start Camera</button>
          <button id="micBtn" class="btn small">Mic Off</button>
          <button id="shareBtn" class="btn small">Share Screen (placeholder)</button>
          <button id="inviteBtn" class="btn small">Invite (placeholder)</button>
        </div>
      </div>
      <div style="margin-top:12px;color:var(--muted);font-size:13px">Controls: Toggle camera and mic. This demo shows local preview only (no signaling).</div>
    `;

    document.getElementById('startBtn').addEventListener('click', async ()=>{
      if(!cameraOn){
        try{ localStream = await navigator.mediaDevices.getUserMedia({video:true,audio:micOn}); document.getElementById('localVideo').srcObject = localStream; cameraOn=true; document.getElementById('startBtn').textContent='Stop Camera'; document.getElementById('cameraOverlay').textContent='Camera on'; }
        catch(e){ alert('Camera or mic access denied/unavailable'); }
      } else {
        if(localStream){ localStream.getTracks().forEach(t=>t.stop()); localStream=null; }
        document.getElementById('localVideo').srcObject=null; cameraOn=false; document.getElementById('startBtn').textContent='Start Camera'; document.getElementById('cameraOverlay').textContent='Camera off';
      }
    });
    document.getElementById('micBtn').addEventListener('click', ()=>{
      micOn = !micOn; document.getElementById('micBtn').textContent = micOn? 'Mic On' : 'Mic Off';
    });
  }

  // Jam tab
  function renderJam(){
    content.innerHTML = `
      <div class="jam-grid">
        <div>
          <div style="margin-bottom:10px"><strong>Drum Pads</strong></div>
          <div class="pads" id="pads"></div>

          <div style="margin-top:12px;background:rgba(255,255,255,0.02);padding:10px;border-radius:8px">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px"><strong>Sequencer</strong><div style="color:var(--muted);font-size:13px">BPM <span id="bpmDisplay">${bpm}</span></div></div>
            <input id="bpmRange" type="range" min="60" max="180" value="${bpm}" style="width:100%" />
            <div style="margin-top:8px;overflow:auto">
              <div id="seqArea"></div>
            </div>
            <div style="margin-top:8px;display:flex;gap:8px">
              <button id="playBtn" class="btn primary">Play</button>
              <button id="resetBtn" class="btn small">Reset</button>
              <button id="clearBtn" class="btn small">Clear</button>
            </div>
          </div>
        </div>

        <div>
          <div><strong>Mixer & Notes</strong></div>
          <div style="margin-top:8px">
            ${pads.map(p=>`<div style="display:flex;align-items:center;gap:8px;margin-bottom:8px"><div style="width:80px">${p.label}</div><input class="vol" data-pad="${p.id}" type="range" min="0" max="1" step="0.01" value="0.9" style="flex:1" /><div style="font-size:12px;color:var(--muted);width:40px;text-align:right">Line ${padToLine[p.id]+1}</div></div>`).join('')}
          </div>

          <div style="margin-top:12px">
            <strong>Notes / Annotations</strong>
            <textarea id="notes" style="width:100%;height:120px;margin-top:8px;border-radius:8px;padding:8px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:inherit" placeholder="Write performance notes / notation hints..."></textarea>
          </div>

          <div style="margin-top:12px;display:flex;gap:8px">
            <button id="expJson" class="btn small">Export Sequence (JSON)</button>
            <button id="expPng" class="btn small">Download Notation (PNG)</button>
          </div>
        </div>
      </div>
    `;

    // render pads
    const padsWrap = document.getElementById('pads'); padsWrap.innerHTML = '';
    pads.forEach((p, i)=>{
      const btn = document.createElement('div'); btn.className='pad'; btn.textContent = p.label; btn.style.background = `linear-gradient(90deg, ${p.color[0]}, ${p.color[1]})`; btn.addEventListener('click', ()=>{ triggerPad(p.id); animatePad(btn);} ); padsWrap.appendChild(btn);
    });

    // seq area
    const seqArea = document.getElementById('seqArea'); seqArea.innerHTML = '';
    sequence.forEach((row, rIdx)=>{
      const rowDiv = document.createElement('div'); rowDiv.className='seq-row';
      const label = document.createElement('div'); label.style.width='72px'; label.style.textAlign='right'; label.style.marginRight='8px'; label.textContent = pads[rIdx].label;
      rowDiv.appendChild(label);
      const stepsDiv = document.createElement('div'); stepsDiv.className='seq-steps';
      row.forEach((cell,cIdx)=>{
        const s = document.createElement('div'); s.className='step'+(cell?' on':''); s.textContent = cIdx+1; if(isPlaying && stepIndex===cIdx) s.classList.add('playing');
        s.addEventListener('click', ()=>{ sequence[rIdx][cIdx]=!sequence[rIdx][cIdx]; render(); });
        stepsDiv.appendChild(s);
      });
      rowDiv.appendChild(stepsDiv); seqArea.appendChild(rowDiv);
    });

    // controls
    document.getElementById('bpmRange').addEventListener('input', (e)=>{ bpm = Number(e.target.value); document.getElementById('bpmDisplay').textContent=bpm; if(isPlaying) restartLoop(); });
    document.getElementById('playBtn').addEventListener('click', ()=>{ if(!isPlaying) startLoop(); else stopLoop(); render(); });
    document.getElementById('resetBtn').addEventListener('click', ()=>{ stepIndex=0; render(); });
    document.getElementById('clearBtn').addEventListener('click', ()=>{ sequence = pads.map(()=> new Array(8).fill(false)); render(); });
    document.getElementById('expJson').addEventListener('click', ()=>{ const data = {bpm, sequence, pads}; const blob = new Blob([JSON.stringify(data,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='sequence.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); });
    document.getElementById('expPng').addEventListener('click', ()=>{ alert('PNG export of notation: use Score tab → right-click save or use screenshot.'); });

    // volume sliders (non-functional in simple synth but present)
    document.querySelectorAll('.vol').forEach(el=>el.addEventListener('input', ()=>{}));
  }

  // Score tab
  function renderScore(){
    // create notation svg for the current stepIndex
    content.innerHTML = `
      <div>
        <div style="margin-bottom:8px"><strong>Five-line Notation (live)</strong></div>
        <div class="staff" id="staffArea"></div>
        <div style="margin-top:8px;display:flex;align-items:center;gap:8px"><label style="color:var(--muted)">View step</label><input id="scoreStep" type="range" min="0" max="7" value="${stepIndex}" style="flex:1" /><div style="width:36px;text-align:right">${stepIndex+1}</div></div>
        <div style="margin-top:8px;color:var(--muted);font-size:13px">Each dot represents a drum hit on the mapped staff line. Use Jam tab to edit the sequence and Score to preview.</div>
      </div>
    `;

    drawStaff(document.getElementById('staffArea'), stepIndex);
    document.getElementById('scoreStep').addEventListener('input',(e)=>{ stepIndex = Number(e.target.value); document.querySelector('#scoreStep + div')?.remove(); drawStaff(document.getElementById('staffArea'), stepIndex); document.querySelector('#scoreStep').nextSibling && (document.querySelector('#scoreStep').nextSibling.textContent = stepIndex+1); });
  }

  function renderFX(){
    content.innerHTML = `
      <div style="text-align:center;padding:18px">
        <h3 style="margin:0 0 8px 0">Live FX & Visuals</h3>
        <div style="color:var(--muted);margin-bottom:12px">Play with reverb, delay and beat visuals (placeholders).</div>
        <div style="display:flex;gap:8px;justify-content:center"><button class="btn small">Reverb</button><button class="btn small">Delay</button><button class="btn small">Beat Visualizer</button></div>
      </div>
    `;
  }

  // draw staff SVG with notes for a step
  function drawStaff(container, showStep){
    const w = Math.min(container.clientWidth || 800, 900); const h = 140; container.innerHTML = '';
    const xmlns = 'http://www.w3.org/2000/svg'; const svg = document.createElementNS(xmlns,'svg'); svg.setAttribute('viewBox',`0 0 ${w} ${h}`); svg.style.width='100%'; svg.style.height='140px';
    // lines
    const left=20; const right=w-20; for(let i=0;i<5;i++){ const y=20 + i*24; const line = document.createElementNS(xmlns,'line'); line.setAttribute('x1',left); line.setAttribute('x2',right); line.setAttribute('y1',y); line.setAttribute('y2',y); line.setAttribute('stroke','#cbd5e1'); line.setAttribute('stroke-opacity','0.25'); svg.appendChild(line);} 
    // step columns
    for(let i=0;i<8;i++){ const x = left + 60 + i*( (right-left-120)/7 ); const l = document.createElementNS(xmlns,'line'); l.setAttribute('x1',x); l.setAttribute('x2',x); l.setAttribute('y1',8); l.setAttribute('y2',h-8); l.setAttribute('stroke','#ffffff'); l.setAttribute('stroke-opacity','0.03'); svg.appendChild(l); }
    // notes
    const notes = sequence.map((row,rIdx)=>({pad:pads[rIdx].id,active:row[showStep],line:padToLine[pads[rIdx].id]})).filter(n=>n.active);
    notes.forEach((n,idx)=>{ const x = left + 60 + showStep*( (right-left-120)/7 ); const y = 20 + (4 - n.line)*24; const c = document.createElementNS(xmlns,'circle'); c.setAttribute('cx',x); c.setAttribute('cy',y); c.setAttribute('r',8); c.setAttribute('fill','#06b6d4'); svg.appendChild(c); });
    container.appendChild(svg);
  }

  // ----- Sequencer loop control -----
  function startLoop(){ if(audioCtx.state==='suspended') audioCtx.resume(); isPlaying=true; scheduleLoop(); }
  function stopLoop(){ isPlaying=false; if(playTimer){ clearInterval(playTimer); playTimer=null; } }
  function restartLoop(){ stopLoop(); if(isPlaying) startLoop(); }
  function scheduleLoop(){ if(playTimer) clearInterval(playTimer); const interval = (60 / bpm) / 2 * 1000; playTimer = setInterval(()=>{ stepIndex = (stepIndex+1)%8; // trigger sounds
      const t = audioCtx.currentTime + 0.02; sequence.forEach((row,rIdx)=>{ if(row[stepIndex]) triggerPad(pads[rIdx].id, t); }); render(); }, interval); }

  // small UI helpers
  function animatePad(el){ el.style.transform='scale(0.98)'; setTimeout(()=>el.style.transform='scale(1)',80); }

  // keyboard controls
  window.addEventListener('keydown',(e)=>{
    if(e.code==='Space'){ e.preventDefault(); if(!isPlaying) startLoop(); else stopLoop(); render(); }
    if(e.key>='1' && e.key<='8'){ const idx = Number(e.key)-1; // toggle first row's step for demo
      // toggle every row at that column (or you could choose a focused row). We'll toggle all for quick demo.
      sequence.forEach(row=> row[idx] = !row[idx]); render(); }
  });

  // tab switching
  TABS.forEach(t=>t.addEventListener('click', ()=>{ TABS.forEach(x=>x.classList.remove('active')); t.classList.add('active'); currentTab = t.dataset.tab; render(); }));

  // initial render
  render();

  // expose some functions for console tinkering
  window._jammeet = {sequence, pads, triggerPad, startLoop, stopLoop};
  </script>
</body>
</html>
